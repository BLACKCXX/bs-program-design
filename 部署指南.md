
[toc]


# 部署与使用指南（BS-程序设计 · 图片管理网站）

>
其实只要输入
docker compose up -d --build

然后访问对应网址就好了


PC：http://localhost:8080


手机（同一局域网）：http://<电脑局域网IP>:8080
>

本文档用于指导 **BS-程序设计 · 图片管理网站** 的部署与使用，目标是通过 **Docker Compose 一键启动** 完整系统（前端、后端、数据库）。  
系统采用 B/S 架构：前端 Vue3，后端 Flask，数据库 MySQL。

## 1. 项目结构说明

项目根目录主要结构如下：

- `browser/`：前端工程（Vue3 + Element Plus + Pinia + Axios + Vite）
  - `src/views/`：页面视图（登录、上传、图库、编辑、标签、搜索等）
  - `src/components/`：可复用 UI 组件
  - `src/assets/`：静态资源
  - `Dockerfile`：前端镜像构建脚本（Node 构建 + Nginx 部署）
- `server/`：后端工程（Flask + JWT）
  - `routes_*.py`：接口路由（图片、标签、AI 等）
  - `app.py`：应用入口（App Factory）
  - `requirements.txt`：后端依赖
  - `Dockerfile`：后端镜像构建脚本
- `database/`：数据库初始化脚本
  - `schema.sql`：建库建表脚本（首次启动自动执行）
- `docker-compose.yml`：多服务编排（db / server / web）
- `.env`：环境变量（AI API Key 等）

## 2. 环境要求

必须：
- Docker Desktop（Windows/macOS）或 Docker Engine（Linux）

可选：
- Git（用于克隆仓库）

不需要本地安装：
- Node.js / Python / MySQL（均在 Docker 镜像中完成）

网络要求：
- 首次构建需从 Docker Hub 拉取基础镜像（网络受限可配置镜像加速）

## 3. 获取代码与准备

方式一：Git 克隆
```bash
git clone <你的仓库地址>
cd BS-程序设计
```

方式二：下载压缩包解压后进入目录，确保包含：
- `docker-compose.yml`
- `browser/`
- `server/`
- `database/schema.sql`
- `.env`

## 4. 配置说明

### 4.1 端口映射（docker-compose.yml）

- 前端（Nginx）：`8080 -> 80`
- 后端（Flask）：`8000 -> 8000`
- 数据库（MySQL）：`3306 -> 3306`

### 4.2 环境变量

`.env` 用于配置 AI 能力（通义千问）：
```
DASHSCOPE_API_KEY=你的Key
```

后端重要环境变量（已在 `docker-compose.yml` 内配置）：
- `DB_HOST=db`
- `DB_PORT=3306`
- `DB_USER=bs_user`
- `DB_PASSWORD=bs_pass_123`
- `DB_NAME=bs_db`
- `JWT_SECRET_KEY=dev-change-me`
- `UPLOAD_DIR=uploads`

如需自定义，可修改 `docker-compose.yml`。

## 5. 一键启动

在项目根目录执行：
```bash
docker compose up -d --build
```

启动完成后访问：
- PC 端：`http://localhost:8080`
- 手机端（同一局域网）：`http://<电脑局域网IP>:8080`

说明：
- 前端通过 Nginx 反向代理 `/api` 与 `/files` 到后端，手机端无需单独配置。

## 6. 数据初始化与持久化

数据库初始化机制：
- `database/schema.sql` 会在 **数据库首次创建时** 自动执行
- 若 `dbdata` 卷已存在，则不会重复执行初始化脚本

数据持久化位置（Docker Volume）：
- `dbdata`：MySQL 数据库
- `uploads_data`：上传图片文件

若要重置为初始状态：
```bash
docker compose down -v
docker compose up -d --build
```

## 7. 备份与恢复（可选）

### 7.1 数据库备份

Windows：
```bash
cmd /c "docker compose exec -T db mysqldump -u bs_user -pbs_pass_123 --no-tablespaces bs_db > db_backup.sql"
```

macOS / Linux：
```bash
docker compose exec -T db mysqldump -u bs_user -pbs_pass_123 --no-tablespaces bs_db > db_backup.sql
```

### 7.2 数据库恢复

Windows：
```bash
cmd /c "docker compose exec -T db mysql -u bs_user -pbs_pass_123 bs_db < db_backup.sql"
```

macOS / Linux：
```bash
docker compose exec -T db mysql -u bs_user -pbs_pass_123 bs_db < db_backup.sql
```

### 7.3 图片文件备份

图片文件保存在 `uploads_data` 数据卷中，建议保留该卷即可。  
如需导出，可通过 `docker volume inspect uploads_data` 获取挂载路径后手动复制。

## 8. 部署验证

启动后可按以下步骤验证：

1. 检查容器状态  
   ```bash
   docker compose ps
   ```
2. 浏览器访问 `http://localhost:8080`
3. 注册新用户并登录
4. 上传图片并查看图库/详情/编辑功能是否正常

## 9. 停止与清理

停止服务（保留数据卷）：
```bash
docker compose down
```

停止并删除数据卷（清空数据库与图片）：
```bash
docker compose down -v
```

## 10. 常用命令

```bash
docker compose up -d --build   # 构建并后台启动
docker compose up              # 前台启动（便于看日志）
docker compose down            # 停止并移除容器
docker compose down -v         # 同时删除数据卷
docker compose restart         # 重启服务
docker compose ps              # 查看运行状态
docker compose logs -f         # 查看日志
docker compose logs -f server  # 只看后端日志
docker compose logs -f web     # 只看前端日志
```

## 11. 常见问题

1) **端口冲突（8080/8000/3306）**  
解决：修改 `docker-compose.yml` 中端口映射后重启。

2) **AI 分析接口报错（DASHSCOPE_API_KEY 未配置）**  
解决：在 `.env` 中填写有效 Key，并重启后端容器。

3) **图片 404 或看不到缩略图**  
解决：确认 `uploads_data` 数据卷未被删除；不要执行 `docker compose down -v`。

4) **构建时 npm ci 失败**  
解决：确保 `browser/package-lock.json` 与 `package.json` 同步，必要时执行一次 `npm install` 更新 lock 后再 build。

如仍有问题，请联系项目作者。
